<!DOCTYPE html>
<html>

<head>

    <link rel="stylesheet" href="css/style.css" />

    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">



    <style>
        body {
            background-image: url("./images/bg.png ");
            background-repeat: no-repeat;
            background-size: cover;
        }
        
        .ui-page {
            background: transparent;
        }
        
        .ui-content {
            background: transparent;
        }
        
        [data-role=footer] {
            bottom: 0;
            position: absolute !important;
            top: auto !important;
            width: 100%;
        }
        
        .body-text {
            color: white;
            font-size: 25px;
        }
    </style>
</head>

<body onload="loadData()">


    <div data-role="page" id="location">

        <div data-role="header">

            <img src="./images/logo.png" alt="Treasure Train Logo" width="200" height="200">

            <div data-demo-html="true">

                <div data-role="navbar" data-grid="c">
                    <ul>
                        <li><a href="#index" class="ui-btn-active">Home</a></li>
                        <li><a href="#">Book Tickets</a></li>
                        <li><a href="/aboutus.html">About Us</a></li>
                        <li><a href="#">Play Game</a></li>
                    </ul>
                </div>
                <!-- /navbar -->
            </div>
            <!--/demo-html -->

        </div>

        <div data-role="content" align="center">

            <h3 id="location-name" class="body-text"></h3>

            <img id="location_image" src="#" alt="location image" width="500" height="300">

            <button type="button" id="Fav" onclick="addToFavourites()">Favourite</button>


            </span>

            <br>

            <!-- Rating Starts -->

            <span class="fa fa-star checked"></span>
            <span class="fa fa-star checked"></span>
            <span class="fa fa-star checked"></span>
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>

            <p id="location-desc" class="body-text"></p>

            <button type="button" class="play_button">Book Tickets</button>
            <button type="button" class="play_button">Play Now</button>

            <br>
            <br>

            <h3 class="body-text">Reviews</h3>

            <div id="reviews">
                <!-- <p class="body-text">Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque
                    eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu.</p>

                <div align="right">
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                </div>

                <hr>

                <p class="body-text">Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque
                    eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu.</p>

                <div align="right">
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                </div>

                <hr>

                <p class="body-text">Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque
                    eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu.</p>

                <div align="right">
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                </div>

                <hr> -->

            </div>

            <h3 class="body-text">Leave a Review</h3>

            <!-- <div class="rate">
                <input type="radio" id="star5" name="rate" value="5" />
                <label for="star5" title="text">5 stars</label>
                <input type="radio" id="star4" name="rate" value="4" />
                <label for="star4" title="text">4 stars</label>
                <input type="radio" id="star3" name="rate" value="3" />
                <label for="star3" title="text">3 stars</label>
                <input type="radio" id="star2" name="rate" value="2" />
                <label for="star2" title="text">2 stars</label>
                <input type="radio" id="star1" name="rate" value="1" />
                <label for="star1" title="text">1 star</label>
            </div> -->

            <textarea id="review-text" rows="6" cols="70" placeholder="Leave a review"></textarea>

            <button type="button" class="play_button" onclick="submitReview()">Submit Review</button>

        </div>

        <div data-role="footer">

        </div>

    </div>

    <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase.js"></script>
    <!-- <script src="js/firebase-init.js"></script> -->

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyCiqITMCVsyHKwdbDgFCowNRwLsfLqiYOY",
            authDomain: "train-cde96.firebaseapp.com",
            databaseURL: "https://train-cde96.firebaseio.com",
            projectId: "train-cde96",
            storageBucket: "train-cde96.appspot.com",
            messagingSenderId: "45911183152",
            appId: "1:45911183152:web:b27375f04a3b109b5442f5",
            measurementId: "G-B29GE7SWEX"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.database();
    </script>

    <script>
        function submitReview() {
            var review = document.getElementById("review-text").value;
            var location = getUrlParams();

            firebase.database().ref('reviews/').push({
                review: review,
                location_name: location
            });


        }

        function loadData() {

            var locationname = getUrlParams();

            document.getElementById("location-name").innerHTML = locationname;

            var ref = firebase.database().ref("reviews");
            ref.orderByChild("location_name").equalTo(locationname).on("child_added", function(snapshot) {

                var newReview = document.createElement("p");
                var horizontalLine = document.createElement("hr");
                var node = document.createTextNode(snapshot.val().review);
                newReview.appendChild(node);

                var ReviewDiv = document.getElementById("reviews");
                ReviewDiv.appendChild(newReview);
                ReviewDiv.appendChild(horizontalLine);
            });


            var ref2 = firebase.database().ref("locations");
            ref2.orderByChild("name").equalTo(locationname).on("child_added", function(snapshot) {

                var imageurl = snapshot.val().image;
                var location_desc = snapshot.val().description;

                document.getElementById("location_image").src = imageurl;
                document.getElementById("location-desc").innerHTML = location_desc;
            });

        }

        function getUrlParams() {
            var url_string = window.location.href;
            var url = new URL(url_string);
            var locationname = url.searchParams.get("locationname");

            return locationname;

        }

        function addToFavourites() {
            var favLocation = getUrlParams();

            var coockie = getCookie("uid");

            firebase.database().ref('users/' + coockie + '/favourites').push({
                locationId: favLocation
            });

            alert("Location added to Favourites");
        }
    </script>

    <script src="js/CookieFunctions.js"></script>
</body>

</html>